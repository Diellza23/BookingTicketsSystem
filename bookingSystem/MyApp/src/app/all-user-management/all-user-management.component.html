<link
  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css"
  rel="stylesheet"
/>
<script
  type="text/javascript"
  src="https://code.jquery.com/jquery-3.5.1.js"
></script>
<script
  type="text/javascript"
  src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"
></script>
<script
  type="text/javascript"
  src="https://cdn.datatables.net/1.12.1/js/dataTables.bootstrap5.min.js"
></script>

<div class="container">
  <div>
    <i class="bx bxs-key btn-lg" style="color: rgb(129, 129, 250)"> </i>
    <h3 style="display: inline">User Management</h3>
    <p
      style="
        display: inline;
        margin-left: 50px;
        color: rgb(123, 126, 126);
        font-size: 14px;
      "
    >
      Authenticate and authorize users
    </p>
  </div>

  <div id="example_wrapper" class="dataTables_wrapper dt-bootstrap5">
    <div class="row">
      <div class="col-sm-12 col-md-6">
        <div id="example_filter">
          <label>Search: </label
          ><input
            class="form-control form-control-sm"
            type="text"
            [(ngModel)]="userName"
            placeholder="Search by name..."
          />
        </div>
      </div>
      <button
        (click)="filterByFullname()"
        class="btn btn-primary col-sm-12 col-md-1 mt-4"
        style="
          width: 50px;
          background-color: rgb(255, 255, 255);
          color: rgb(120, 120, 120);
          border: 1px solid grey;
        "
      >
        <i class="fa fa-search"></i>
      </button>
    </div>

    <div class="row">
      <div class="col-sm-12">
        <table
          id="example"
          class="table dataTable"
          style="width: 100%"
          aria-describedby="example_info"
        >
          <thead>
            <tr>
              <th
                class="sorting sorting_asc"
                tabindex="0"
                aria-controls="example"
                rowspan="1"
                colspan="1"
                aria-sort="ascending"
                aria-label="Name: activate to sort column descending"
                style="width: 61px"
              >
                #
              </th>
              <th
                class="sorting sorting_asc"
                tabindex="0"
                aria-controls="example"
                rowspan="1"
                colspan="1"
                aria-sort="ascending"
                aria-label="Name: activate to sort column descending"
                style="width: 61px"
              >
                Name
              </th>
              <th
                class="sorting"
                tabindex="0"
                aria-controls="example"
                rowspan="1"
                colspan="1"
                aria-label="Position: activate to sort column ascending"
                style="width: 74px"
              >
                Email
              </th>
              <th
                class="sorting"
                tabindex="0"
                aria-controls="example"
                rowspan="1"
                colspan="1"
                aria-label="Office: activate to sort column ascending"
                style="width: 51px"
              >
                Username
              </th>
              <th
                class="sorting"
                tabindex="0"
                aria-controls="example"
                rowspan="1"
                colspan="1"
                aria-label="Age: activate to sort column ascending"
                style="width: 30px"
              >
                Contact
              </th>
              <th
                class="sorting"
                tabindex="0"
                aria-controls="example"
                rowspan="1"
                colspan="1"
                aria-label="Start date: activate to sort column ascending"
                style="width: 41px"
              >
                Address
              </th>
              <th
                class="sorting"
                tabindex="0"
                aria-controls="example"
                rowspan="1"
                colspan="1"
                aria-label="Salary: activate to sort column ascending"
                style="width: 58px"
              >
                Country
              </th>
              <th
                class="sorting"
                tabindex="0"
                aria-controls="example"
                rowspan="1"
                colspan="1"
                aria-label="Salary: activate to sort column ascending"
                style="width: 58px"
              >
                State
              </th>
              <th
                class="sorting"
                tabindex="0"
                aria-controls="example"
                rowspan="1"
                colspan="1"
                aria-label="Salary: activate to sort column ascending"
                style="width: 58px"
              >
                Actions
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              class="odd"
              *ngFor="let user of filteredUserList; let i = index"
            >
              <td class="sorting_1">
                <input
                  class="form-check-input"
                  type="checkbox"
                  value=""
                  id="flexCheckDefault"
                />
              </td>
              <td>{{ user.fullName }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.userName }}</td>
              <td>{{ user.phoneNumber }}</td>
              <td>{{ user.address }}</td>
              <td>{{ user.country }}</td>
              <td>{{ user.state }}</td>
              <td>
                <i
                  type="button"
                  class="bx bx-trash btn btn-outline-danger"
                  (click)="deleteUser(user.id)"
                >
                </i>
                <i
                  type="button"
                  class="bx bx-edit btn btn-outline-primary"
                  routerLink="/edit-user-info/{{ user.id }}"
                >
                </i>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <th rowspan="1" colspan="1">Name</th>
              <th rowspan="1" colspan="1">Email</th>
              <th rowspan="1" colspan="1">Username</th>
              <th rowspan="1" colspan="1">Contact</th>
              <th rowspan="1" colspan="1">Address</th>
              <th rowspan="1" colspan="1">Country</th>
              <th rowspan="1" colspan="1">State</th>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12 col-md-5">
        <div
          class="dataTables_info"
          id="example_info"
          role="status"
          aria-live="polite"
        >
          Showing 1 to 10 of 57 entries
        </div>
      </div>
      <div class="col-sm-12 col-md-7">
        <div
          class="dataTables_paginate paging_simple_numbers"
          id="example_paginate"
        >
          <ul class="pagination">
            <li
              class="paginate_button page-item previous disabled"
              id="example_previous"
            >
              <a
                href="#"
                aria-controls="example"
                data-dt-idx="0"
                tabindex="0"
                class="page-link"
                >Previous</a
              >
            </li>
            <li class="paginate_button page-item active">
              <a
                href="#"
                aria-controls="example"
                data-dt-idx="1"
                tabindex="0"
                class="page-link"
                >1</a
              >
            </li>
            <li class="paginate_button page-item">
              <a
                href="#"
                aria-controls="example"
                data-dt-idx="2"
                tabindex="0"
                class="page-link"
                >2</a
              >
            </li>
            <li class="paginate_button page-item">
              <a
                href="#"
                aria-controls="example"
                data-dt-idx="3"
                tabindex="0"
                class="page-link"
                >3</a
              >
            </li>
            <li class="paginate_button page-item">
              <a
                href="#"
                aria-controls="example"
                data-dt-idx="4"
                tabindex="0"
                class="page-link"
                >4</a
              >
            </li>
            <li class="paginate_button page-item">
              <a
                href="#"
                aria-controls="example"
                data-dt-idx="5"
                tabindex="0"
                class="page-link"
                >5</a
              >
            </li>
            <li class="paginate_button page-item">
              <a
                href="#"
                aria-controls="example"
                data-dt-idx="6"
                tabindex="0"
                class="page-link"
                >6</a
              >
            </li>
            <li class="paginate_button page-item next" id="example_next">
              <a
                href="#"
                aria-controls="example"
                data-dt-idx="7"
                tabindex="0"
                class="page-link"
                >Next</a
              >
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  getPagination("#table-id");
  function getPagination(table) {
    var lastPage = 1;
    $("#maxRows")
      .on("change", function (evt) {
        //$('.paginationprev').html('');                      // reset pagination
        lastPage = 1;
        $(".pagination").find("li").slice(1, -1).remove();
        var trnum = 0; // reset tr counter
        var maxRows = parseInt($(this).val()); // get Max Rows from select option
        if (maxRows == 5000) {
          $(".pagination").hide();
        } else {
          $(".pagination").show();
        }
        var totalRows = $(table + " tbody tr").length; // numbers of rows
        $(table + " tr:gt(0)").each(function () {
          // each TR in  table and not the header
          trnum++; // Start Counter
          if (trnum > maxRows) {
            // if tr number gt maxRows
            $(this).hide(); // fade it out
          }
          if (trnum <= maxRows) {
            $(this).show();
          } // else fade in Important in case if it ..
        }); //  was fade out to fade it in
        if (totalRows > maxRows) {
          // if tr total rows gt max rows option
          var pagenum = Math.ceil(totalRows / maxRows); // ceil total(rows/maxrows) to get ..
          //  numbers of pages
          for (var i = 1; i <= pagenum; ) {
            // for each page append pagination li
            $(".pagination #prev")
              .before(
                '<li data-page="' +
                  i +
                  '">\
                                  <span>' +
                  i++ +
                  '<span class="sr-only">(current)</span></span>\
                                </li>'
              )
              .show();
          } // end for i
        } // end if row count > max rows
        $('.pagination [data-page="1"]').addClass("active"); // add active class to the first li
        $(".pagination li").on("click", function (evt) {
          // on click each page
          evt.stopImmediatePropagation();
          evt.preventDefault();
          var pageNum = $(this).attr("data-page"); // get it's number

          var maxRows = parseInt($("#maxRows").val()); // get Max Rows from select option

          if (pageNum == "prev") {
            if (lastPage == 1) {
              return;
            }
            pageNum = --lastPage;
          }
          if (pageNum == "next") {
            if (lastPage == $(".pagination li").length - 2) {
              return;
            }
            pageNum = ++lastPage;
          }

          lastPage = pageNum;
          var trIndex = 0; // reset tr counter
          $(".pagination li").removeClass("active"); // remove active class from all li
          $('.pagination [data-page="' + lastPage + '"]').addClass("active"); // add active class to the clicked
          // $(this).addClass('active');                  // add active class to the clicked
          limitPagging();
          $(table + " tr:gt(0)").each(function () {
            // each tr in table not the header
            trIndex++; // tr index counter
            // if tr index gt maxRows*pageNum or lt maxRows*pageNum-maxRows fade if out
            if (
              trIndex > maxRows * pageNum ||
              trIndex <= maxRows * pageNum - maxRows
            ) {
              $(this).hide();
            } else {
              $(this).show();
            } //else fade in
          }); // end of for each tr in table
        }); // end of on click pagination list
        limitPagging();
      })
      .val(5)
      .change();

    // end of on select change

    // END OF PAGINATION
  }

  function limitPagging() {
    // alert($('.pagination li').length)

    if ($(".pagination li").length > 7) {
      if ($(".pagination li.active").attr("data-page") <= 3) {
        $(".pagination li:gt(5)").hide();
        $(".pagination li:lt(5)").show();
        $('.pagination [data-page="next"]').show();
      }
      if ($(".pagination li.active").attr("data-page") > 3) {
        $(".pagination li:gt(0)").hide();
        $('.pagination [data-page="next"]').show();
        for (
          let i = parseInt($(".pagination li.active").attr("data-page")) - 2;
          i <= parseInt($(".pagination li.active").attr("data-page")) + 2;
          i++
        ) {
          $('.pagination [data-page="' + i + '"]').show();
        }
      }
    }
  }

  $(function () {
    // Just to append id number for each row
    $("table tr:eq(0)").prepend("<th> ID </th>");

    var id = 0;

    $("table tr:gt(0)").each(function () {
      id++;
      $(this).prepend("<td>" + id + "</td>");
    });
  });
</script>
